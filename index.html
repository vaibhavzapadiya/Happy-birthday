import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, ReactiveFormsModule } from '@angular/forms';
import { FeedbackserviceService } from '../feedbackservice.service';
import { CommonModule } from '@angular/common';
import { Feedback } from '../feedbackservice.service';

@Component({
  selector: 'app-feedback',
  standalone: true,
  imports: [ReactiveFormsModule, CommonModule],
  templateUrl: './feedback.component.html',
  styleUrls: ['./feedback.component.css'], // Corrected property name
})
export class FeedbackComponent implements OnInit {
  form: FormGroup;
  feedbacklist: Feedback[] = [];
  editmode: boolean = false;
  editindex: number | null = null; // Initialized to null

  constructor(
    private formBuilder: FormBuilder,
    private feedbackservice: FeedbackserviceService
  ) {
    this.form = this.formBuilder.group({
      customerName: [''],
      feedbackMessage: [''],
      feedbackRating: [''],
    });
  }

  ngOnInit() {
    this.feedbacklist = this.feedbackservice.getFeedback();
  }

  submitFeedback() {
    if (this.editmode && this.editindex !== null) {
      this.feedbackservice.updateFeedback(this.editindex, this.form.value);
      this.editmode = false;
      this.editindex = null; // Resetting after editing
    } else {
      this.feedbackservice.submitFeedback(this.form.value);
    }
    this.form.reset(); // Reset form in both cases
  }

  editFeedback(id: number) {
    this.editmode = true;
    this.editindex = id;
    this.form.patchValue(this.feedbacklist[id]);
  }

  delete(id: number) {
    this.feedbackservice.deleteFeedback(id); // Assuming service handles deletion
    this.feedbacklist = this.feedbackservice.getFeedback(); // Refresh list
  }

  cancel() {
    this.editmode = false;
    this.editindex = null; // Reset edit index
    this.form.reset();
  }
}